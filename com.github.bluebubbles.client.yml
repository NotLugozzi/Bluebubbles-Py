app-id: com.github.bluebubbles.client
runtime: org.gnome.Platform
runtime-version: '47'
sdk: org.gnome.Sdk
command: bluebubbles
finish-args:
  - --share=network
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --filesystem=xdg-cache:create
  - --filesystem=xdg-config:create
  - --filesystem=xdg-data:create
  - --talk-name=org.freedesktop.secrets
  - --talk-name=org.gtk.vfs.*
  - --filesystem=xdg-run/gvfsd

modules:
  - name: python3-pygobject
    buildsystem: simple
    build-commands: []
    modules:
      - name: python3-pycairo
        buildsystem: simple
        build-commands:
          - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
            --prefix=${FLATPAK_DEST} "pycairo" --no-build-isolation
        sources:
          - type: file
            url: https://files.pythonhosted.org/packages/d1/4a/5270ed8fdbeb65145b0361c437792e70c331b6b667f937f2956e2ab2ad1b2/pycairo-1.26.1.tar.gz
            sha256: 5cb21e7a00a2afcafea7f14390235be33497a2cce53a75e6e3b64b5f29b43c5a

  - name: python3-requests
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "requests" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/f9/9b/335f9764261e915ed497fcdeb11df5dfd6f7bf257d4a6a2a686d80da4d54f/requests-2.32.3-py3-none-any.whl
        sha256: 70761cfe03c773ceb22aa2f671b4757976145175cdfca038c02654d061d6dcc6
      - type: file
        url: https://files.pythonhosted.org/packages/12/90/3c9ff0512038035f59d279fddeb79f5f1eccd8859f06d6163c58798b9d7c9/certifi-2024.8.30-py3-none-any.whl
        sha256: 922820b53db23c5979b9b0c5b1f2030b78369a1d7616d03fe75e9ecf00e3e4b8
      - type: file
        url: https://files.pythonhosted.org/packages/63/09/c1bc53dab74b1816a00d8d030de5bf98f724c52c1635e07681d312f20be8/charset-normalizer-3.3.2.tar.gz
        sha256: f30c3cb33b24454a82faecaf01b19c18562b1e89558fb6c56de4d9118a032fd5
      - type: file
        url: https://files.pythonhosted.org/packages/76/c6/c88e154df9c4e1a2a66ccf0005a88dfb2650c1dffb6f5ce603dfbd452ce3/idna-3.10-py3-none-any.whl
        sha256: 946d195a0d259cbba61165e88e65941f16e9b36ea6ddb97f00452bae8b1287d3
      - type: file
        url: https://files.pythonhosted.org/packages/f7/a4/700e89faaae276962a7a43edfd2edd7c71b1d1ac25aacff2e4e3a9de73fc5/urllib3-2.2.3-py3-none-any.whl
        sha256: ca899ca043dcb1bafa3e262d73aa25c465bfb49e0bd9dd5d59f1d0acba2f8fac

  - name: python3-toml
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "toml" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/44/6f/7120676b6d73228f96e17f03dd34e40b6f45ad7378e4bd7a0e8aeb00f1f56/toml-0.10.2-py2.py3-none-any.whl
        sha256: 806143ae5bfb6a3c6e736a764057db0e6a0e05e338b5630894a5f779cabb4f9b

  - name: python3-aiohttp
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "aiohttp" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/17/e0/58db529fcb8f0e89ee8b2ef9a2bf2f180b98709c90bd1d9c6b8a7c50e4e91/aiohttp-3.10.6-cp312-cp312-linux_x86_64.whl
        sha256: 80b3c9fdb1d3c3a1f5f8bdcc32ac2bdc18725c4c8a12e22b1fc6a9e5ff1e8a92
      - type: file
        url: https://files.pythonhosted.org/packages/45/58/8c716e8b4e875e86228b8b7a8d96c9a7b2c0ab8c7e8df93a65e8f5c8de8b/aiosignal-1.3.1-py3-none-any.whl
        sha256: f8376fb07dd1e86a584e4fcdec80b36b7f81aac666ebc724e2c090300dd83b17
      - type: file
        url: https://files.pythonhosted.org/packages/17/3a/5e2eecd4765d8a9b14ea1ec8bc75f52c62b4aa95e3e2e4a86f82f5a5b1f0/attrs-24.2.0-py3-none-any.whl
        sha256: 5cfb1b9148b5b086569baec03f20d7b6bf3bcacc9a42bebf87ffaaca362f6346
      - type: file
        url: https://files.pythonhosted.org/packages/76/ac/a7305707cb852b7e16ff80eaf5692309bde30e2b1100a1aa4a5db28a5ef6/frozenlist-1.4.1-cp312-cp312-linux_x86_64.whl
        sha256: 327e892f0b0f7c7a0d94e6c9b1700fb96c4b6334b7e8b4a92b9b3e32f15b2ae7
      - type: file
        url: https://files.pythonhosted.org/packages/82/35/1c7518d038d626b16dc1be5e5e4ce87b6c82d9e7de32fd0c0e2a6b9b7aef8/multidict-6.1.0-cp312-cp312-linux_x86_64.whl
        sha256: a3f14c4b1c9e07d1a6c83a9c7a25da36ad10db9a4b85a59eefa10893e77e0e5d
      - type: file
        url: https://files.pythonhosted.org/packages/d5/8e/eb4bbf10b01a0d0a9f7b5e8bea5e88f77c4bcf93bfd78b6d0b3b23b1b3e8/yarl-1.11.1-cp312-cp312-linux_x86_64.whl
        sha256: 9ede61b0854e267fd565e7527bcb79547e92996e8e59b7b3f6e6eaf6d5d1c8f

  - name: python3-pillow
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "Pillow" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/a5/26/0d95c04c868f6bdb0c447e3ee2de5564411845e19a8b65b58ba90ed27cd0/Pillow-10.4.0-cp312-cp312-linux_x86_64.whl
        sha256: 7e6e52f8a2da5bb04c9c1fd1f94cf5c6b7e4b6d1b7ecb0a6e0b6d5e7b5f5c4e

  - name: bluebubbles
    buildsystem: simple
    build-commands:
      - install -Dm755 main.py ${FLATPAK_DEST}/bin/bluebubbles
      - cp -r src ${FLATPAK_DEST}/lib/python3.12/site-packages/
      - install -Dm644 com.github.bluebubbles.client.desktop ${FLATPAK_DEST}/share/applications/com.github.bluebubbles.client.desktop
      - install -Dm644 com.github.bluebubbles.client.metainfo.xml ${FLATPAK_DEST}/share/metainfo/com.github.bluebubbles.client.metainfo.xml
      - install -Dm644 icons/com.github.bluebubbles.client.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/com.github.bluebubbles.client.svg || true
    sources:
      - type: dir
        path: .
